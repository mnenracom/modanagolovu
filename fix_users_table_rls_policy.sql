-- SQL скрипт для исправления RLS политик таблицы users
-- Выполните в Supabase SQL Editor

-- Удаляем существующие политики INSERT (если есть), чтобы избежать конфликтов
DROP POLICY IF EXISTS "Пользователи создают свои записи" ON users;
DROP POLICY IF EXISTS "Анонимные пользователи могут создавать записи" ON users;

-- Добавляем политику для INSERT - пользователи могут создавать свои записи
-- Это нужно для регистрации новых пользователей
CREATE POLICY "Пользователи создают свои записи" ON users
  FOR INSERT
  WITH CHECK (auth.uid() = id);

-- Альтернативный вариант: если хотите разрешить создание записей для всех анонимных пользователей
-- (триггер handle_new_user уже создает записи автоматически, но эта политика позволит и ручное создание)
-- Раскомментируйте следующую строку, если нужен публичный доступ для создания записей:
-- CREATE POLICY "Анонимные пользователи могут создавать записи" ON users
--   FOR INSERT
--   WITH CHECK (true);

-- Если хотите полностью отключить RLS для таблицы users (проще, но менее безопасно):
-- ALTER TABLE users DISABLE ROW LEVEL SECURITY;

