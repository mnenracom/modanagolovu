# Настройка OZON API для получения данных о продажах

## Получение API ключей

1. Войдите в личный кабинет OZON Seller: https://seller.ozon.ru/
2. Перейдите в раздел **"Настройки"** → **"API интеграции"** → **"Seller API"**
3. Создайте новый API ключ или используйте существующий
4. Скопируйте:
   - **Client ID** (идентификатор клиента)
   - **API Key** (ключ API)

## Настройка в админ-панели

1. Откройте админ-панель → **"Настройки МП"** (`/admin/marketplace`)
2. Нажмите **"Добавить аккаунт"**
3. Выберите **"OZON"**
4. Заполните поля:
   - **Название аккаунта**: например, "OZON Основной"
   - **API Key**: вставьте API Key из личного кабинета OZON
   - **Client ID**: вставьте Client ID из личного кабинета OZON
5. Нажмите **"Сохранить"**

## Проверка подключения

1. После сохранения нажмите кнопку **"Тест подключения"** рядом с аккаунтом
2. Если подключение успешно, вы увидите сообщение об успехе
3. Если есть ошибка, проверьте правильность API Key и Client ID

## Синхронизация данных

1. Нажмите кнопку **"Синхронизировать"** рядом с аккаунтом OZON
2. Данные будут загружены за последние 7 дней
3. После синхронизации данные появятся в дашборде маркетплейсов

## Какие данные получаем

OZON API предоставляет следующие данные через endpoint `/v3/finance/transaction/list`:

### Выручка (revenue)
- **accruals_for_sale** - начисления за продажу (выручка)
- Только реально проданные (выкупленные) товары

### Расходы
- **sale_commission** - комиссия OZON за продажу
- **delivery_charge** - стоимость доставки
- **accruals_for_sale_delivery** - начисления за доставку
- **sale_commission_delivery** - комиссия за доставку
- **storage_fee** - плата за хранение
- **penalty** - штрафы
- **other_deductions** - прочие удержания
- **return_delivery_charge** - стоимость возврата доставки
- **accruals_for_sale_return** - начисления за возврат
- **sale_commission_return** - комиссия за возврат

### Прибыль
- **profit** = выручка - все расходы (комиссия + логистика + хранение + штрафы + возвраты)

### Статистика
- **itemsSold** - количество реально проданных (выкупленных) товаров
- **ordersCount** - количество заказов
- **averageOrderValue** - средний чек

## Важные замечания

1. **Только выкупленные товары**: Система автоматически фильтрует данные и учитывает только реально проданные (выкупленные) товары, исключая возвраты и отмены.

2. **Типы операций**:
   - `operation` - продажа (выручка)
   - `delivery` - доставка (расход)
   - `services` - услуги (расход)
   - `other_deductions` - прочие удержания (расход)
   - `return` - возврат (исключается из прибыли)

3. **Период синхронизации**: По умолчанию синхронизируются данные за последние 7 дней. Вы можете изменить период в дашборде маркетплейсов.

4. **Частота синхронизации**: Рекомендуется синхронизировать данные ежедневно для актуальной статистики.

## Проблемы и решения

### Ошибка "Client ID не указан"
- Убедитесь, что вы заполнили поле "Client ID" при создании аккаунта OZON

### Ошибка 401 (Unauthorized)
- Проверьте правильность API Key и Client ID
- Убедитесь, что API ключ активен в личном кабинете OZON

### Ошибка 403 (Forbidden)
- Проверьте права доступа API ключа
- Убедитесь, что у API ключа есть доступ к финансовым данным

### Данные не синхронизируются
- Проверьте интернет-соединение
- Убедитесь, что API ключ не истек
- Проверьте логи в консоли браузера (F12) для детальной информации об ошибке

## Дополнительная информация

- Официальная документация OZON API: https://docs.ozon.ru/api/seller/
- Endpoint финансовых транзакций: `/v3/finance/transaction/list`
- Endpoint заказов: `/v3/posting/fbs/list`
- Endpoint аналитики: `/v1/analytics/data`


