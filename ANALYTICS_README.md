# Аналитика для Dual-цен

## Обзор

Реализована полная система аналитики для отслеживания эффективности dual-цен (розничных и оптовых цен) в админ-панели.

## Что реализовано

### 1. Dashboard в админке (`/admin/analytics`)

**Статистика по типам заказов:**
- Количество розничных заказов
- Количество оптовых заказов
- Средний чек по каждому типу
- Общая статистика

**Конверсия в опт:**
- Процент конверсии в опт
- Процент переходов из розницы в опт
- Общее количество заказов

**Средняя экономия:**
- Общая экономия клиентов
- Средняя экономия на заказ
- Средний процент экономии

**Выручка по типам:**
- Выручка от розничных заказов
- Выручка от оптовых заказов
- Распределение в процентах
- Общая выручка

**Фильтры по датам:**
- Сегодня
- Неделя
- Месяц
- Год
- Все время

### 2. Отчёты (`/admin/analytics/reports`)

**Эффективность ценовой стратегии:**
- Общее количество товаров
- Количество товаров с оптовыми ценами
- Средний порог оптовых цен
- Средний процент экономии
- Топ товаров по эффективности (конверсия в опт)

**Анализ порогов:**
- Рекомендуемый порог (средний из эффективных)
- Оптимальный порог (с максимальной конверсией)
- Детальная статистика по каждому порогу:
  - Количество заказов
  - Средний чек
  - Конверсия в опт

**Топ товаров по переходу в опт:**
- Рейтинг товаров по конверсии
- Количество розничных и оптовых заказов
- Выручка по каждому товару
- Средний чек

### 3. A/B тестирование порогов (`/admin/analytics/ab-testing`)

**Функционал:**
- Создание A/B тестов для сравнения различных порогов оптовых цен
- Управление тестами (активация, приостановка, завершение)
- Отслеживание результатов:
  - Конверсия для контрольной группы
  - Конверсия для варианта
  - Определение победителя
  - Уровень уверенности (confidence)
- Настройка разделения трафика (%)

## Файлы

### SQL
- `create_ab_testing_table.sql` - Таблица для A/B тестирования

### Сервисы
- `src/services/analyticsService.ts` - Сервис для получения аналитики
- `src/services/abTestingService.ts` - Сервис для работы с A/B тестами

### Хуки
- `src/hooks/useAnalytics.ts` - Хук для работы с аналитикой

### Компоненты
- `src/pages/admin/AnalyticsDashboard.tsx` - Dashboard с основной статистикой
- `src/pages/admin/AnalyticsReports.tsx` - Отчёты по эффективности
- `src/pages/admin/ABTesting.tsx` - Управление A/B тестами

### Интеграция
- `src/App.tsx` - Добавлены маршруты для аналитики
- `src/components/admin/AdminLayout.tsx` - Добавлены пункты меню

## Использование

1. **Выполните SQL-скрипт** для создания таблицы A/B тестирования:
   ```sql
   -- Выполните create_ab_testing_table.sql в Supabase SQL Editor
   ```

2. **Откройте админ-панель** и перейдите в раздел "Аналитика"

3. **Просматривайте статистику** на главной странице аналитики

4. **Изучайте отчёты** в разделе "Отчёты"

5. **Создавайте A/B тесты** в разделе "A/B тесты"

## Доступ

- **Аналитика** и **Отчёты**: доступны для ролей `admin` и `manager`
- **A/B тесты**: доступны только для роли `admin`

## Особенности

- Все данные загружаются асинхронно с обработкой ошибок
- Поддержка фильтрации по датам
- Автоматический расчёт конверсий и статистики
- Визуализация данных с помощью прогресс-баров и графиков
- Адаптивный дизайн для всех устройств

## Примечания

- Если таблицы `orders` или `products` не существуют, система вернёт значения по умолчанию (0) вместо ошибки
- A/B тесты требуют достаточного количества данных для статистической значимости (минимум 30 посетителей в каждой группе)
- Рекомендуется регулярно проверять результаты A/B тестов и завершать их при достижении статистической значимости


