# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ —Ç–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

## üìã –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ –æ–ø—Ç–æ–≤—ã–µ –∏ —Ä–æ–∑–Ω–∏—á–Ω—ã–µ –∑–∞–∫–∞–∑—ã:
- **–û–ø—Ç–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ–æ—Ä–º—É –∑–∞—è–≤–∫–∏ (–ª–∏—á–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ)
- **–†–æ–∑–Ω–∏—á–Ω—ã–µ –∑–∞–∫–∞–∑—ã**: –ü—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—ã–±–æ—Ä–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ ‚Üí —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### 1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

#### `src/pages/DeliverySelection.tsx`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—ã–±–æ—Ä–∞ —Ç–æ—á–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è —Ä–æ–∑–Ω–∏—á–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –í–≤–æ–¥ –≥–æ—Ä–æ–¥–∞/—Ä–µ–≥–∏–æ–Ω–∞/–ø–æ—á—Ç–æ–≤–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞
- –ü–æ–∏—Å–∫ —Ç–æ—á–µ–∫ –≤—ã–¥–∞—á–∏ —á–µ—Ä–µ–∑ API –ü–æ—á—Ç—ã –†–æ—Å—Å–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∏–¥–∂–µ—Ç –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ API
- –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
- –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ–ø–ª–∞—Ç—ã

**–°–æ—Å—Ç–æ—è–Ω–∏—è**:
- `addressData`: –î–∞–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ (–≥–æ—Ä–æ–¥, —Ä–µ–≥–∏–æ–Ω, –∏–Ω–¥–µ–∫—Å)
- `postOffices`: –°–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫ –≤—ã–¥–∞—á–∏
- `selectedOffice`: –í—ã–±—Ä–∞–Ω–Ω–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ
- `deliveryCalculation`: –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
- `useWidget`: –§–ª–∞–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞ (fallback)
- `calculating`: –°—Ç–∞—Ç—É—Å —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã**:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –≥–æ—Ä–æ–¥
2. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `handleSearchPostOffices()`
3. –ü—Ä–æ–±—É–µ—Ç—Å—è API —á–µ—Ä–µ–∑ `russianPostService.searchPostOffices()`
4. –ï—Å–ª–∏ API –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (CORS/417) ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–∏–¥–∂–µ—Ç
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –æ—Ç–¥–µ–ª–µ–Ω–∏–µ
6. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `handleSelectOffice()` ‚Üí —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
7. –ü–æ—è–≤–ª—è–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ"

#### `src/components/delivery/RussianPostWidget.tsx`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞ –ü–æ—á—Ç—ã –†–æ—Å—Å–∏–∏

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ –≤–∏–¥–∂–µ—Ç–∞: `https://widget.pochta.ru/map/widget/widget.js`
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–∞ —á–µ—Ä–µ–∑ `ecomStartWidget()`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ callback –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è
- –û–±—Ä–∞–±–æ—Ç–∫–∞ postMessage —Å–æ–±—ã—Ç–∏–π
- MutationObserver –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π DOM
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä –æ—Ç–¥–µ–ª–µ–Ω–∏—è" –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∏–¥–∂–µ—Ç–∞**:
```javascript
ecomStartWidget({
  id: 60084, // ID –≤–∏–¥–∂–µ—Ç–∞ –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
  callbackFunction: callbackFunction, // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã–±–æ—Ä–∞
  containerId: 'ecom-widget' // ID –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
})
```

**–ü—Ä–æ–±–ª–µ–º–∞**: Callback –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –≤ –≤–∏–¥–∂–µ—Ç–µ.

#### `src/pages/Payment.tsx`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–ø–ª–∞—Ç—ã —Ä–æ–∑–Ω–∏—á–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –í–≤–æ–¥ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –í—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã (–æ–Ω–ª–∞–π–Ω/–Ω–∞–ª–∏—á–Ω—ã–º–∏)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ÆKassa
- –ü–µ—Ä–µ—Ö–æ–¥ –∫ –æ–ø–ª–∞—Ç–µ

### 2. –°–µ—Ä–≤–∏—Å—ã

#### `src/services/russianPostService.ts`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API –ü–æ—á—Ç—ã –†–æ—Å—Å–∏–∏

**–ú–µ—Ç–æ–¥—ã**:
- `getApiCredentials()`: –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞ –∏ —Ç–æ–∫–µ–Ω–∞ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- `searchPostOffices(address)`: –ü–æ–∏—Å–∫ —Ç–æ—á–µ–∫ –≤—ã–¥–∞—á–∏
- `calculateDelivery(from, to, weight, value)`: –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
- `getPostOfficeById(id)`: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—Ç–¥–µ–ª–µ–Ω–∏–∏

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Edge Function –¥–ª—è –æ–±—Ö–æ–¥–∞ CORS
- Fallback –Ω–∞ –ø—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å —Å –∫–ª–∏–µ–Ω—Ç–∞ (–µ—Å–ª–∏ Edge Function –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ 417 (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ IP)

**–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**:
- API URL: `https://otpravka-api.pochta.ru` (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
- –¢–æ–∫–µ–Ω: `ty2372MFNCTRiqBF8OfmoBBuMh785Ldy` (–Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å)

#### `supabase/functions/russian-post-api/index.ts`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: Edge Function –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API –ü–æ—á—Ç—ã –†–æ—Å—Å–∏–∏

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –û–±—Ö–æ–¥ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π CORS
- –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API –ü–æ—á—Ç—ã –†–æ—Å—Å–∏–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (Authorization-Key –∏ AccessToken)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π:
  - `search_post_offices`: –ü–æ–∏—Å–∫ –æ—Ç–¥–µ–ª–µ–Ω–∏–π
  - `calculate_delivery`: –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
  - `get_post_office`: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—Ç–¥–µ–ª–µ–Ω–∏–∏

**–ó–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤**:
```javascript
{
  'Authorization': `AccessToken ${apiToken || apiKey}`,
  'Authorization-Key': apiKey,
  'Content-Type': 'application/json',
  'Accept': 'application/json',
  'User-Agent': 'Mozilla/5.0...',
  // ... –¥—Ä—É–≥–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ –∑–∞—â–∏—Ç—ã –æ—Ç –±–æ—Ç–æ–≤
}
```

**–¢–µ–∫—É—â–∏–π URL API**: `https://otpravka-api.pochta.ru`

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–æ—Ä–∑–∏–Ω–æ–π

#### `src/components/cart/CartSummary.tsx`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –∑–∞–∫–∞–∑–∞ (`pricing.orderType`)
- –î–ª—è –æ–ø—Ç–∞ ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `/checkout`
- –î–ª—è —Ä–æ–∑–Ω–∏—Ü—ã ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `/delivery`

#### `src/pages/Checkout.tsx`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –∑–∞–∫–∞–∑–∞
- –†–µ–¥–∏—Ä–µ–∫—Ç —Ä–æ–∑–Ω–∏—á–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ `/delivery`
- –¢–æ–ª—å–∫–æ –æ–ø—Ç–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∑–¥–µ—Å—å

## üî¥ –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ #1: –í–∏–¥–∂–µ—Ç –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç callback –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–û–ø–∏—Å–∞–Ω–∏–µ**:
- –í–∏–¥–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∫–∞—Ä—Ç—É
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –æ—Ç–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç–µ
- –í–∏–¥–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–∞–Ω–µ–ª—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—Ç–¥–µ–ª–µ–Ω–∏–∏ (‚Ññ 652600, –∞–¥—Ä–µ—Å, —Å—Ç–æ–∏–º–æ—Å—Ç—å, —Å—Ä–æ–∫)
- **–ù–û**: Callback —Ñ—É–Ω–∫—Ü–∏—è `callbackFunction` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ**:
1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ `postMessage` —Å–æ–±—ã—Ç–∏–π
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `MutationObserver` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π DOM
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä –æ—Ç–¥–µ–ª–µ–Ω–∏—è" –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
4. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –≤ –∫–æ–Ω—Å–æ–ª—å

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
- –í–∏–¥–∂–µ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–∞—Ä—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –æ—Ç–¥–µ–ª–µ–Ω–∏–µ
- Callback –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä" –ø—ã—Ç–∞–µ—Ç—Å—è –∏–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤–∏–¥–∂–µ—Ç–∞, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞ –Ω–∞—Ö–æ–¥–∏—Ç –∏—Ö

**–í–æ–ø—Ä–æ—Å—ã –¥–ª—è –¥—Ä—É–≥–∏—Ö –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π**:
1. –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –∏–∑ –≤–∏–¥–∂–µ—Ç–∞ –ü–æ—á—Ç—ã –†–æ—Å—Å–∏–∏?
2. –ú–æ–∂–µ—Ç –ª–∏ –≤–∏–¥–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –º–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö (–Ω–µ callback)?
3. –ù—É–∂–Ω–æ –ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–∏–¥–∂–µ—Ç –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã callback?
4. –ï—Å—Ç—å –ª–∏ —Å–ø–æ—Å–æ–± –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ –∏–∑ –≤–∏–¥–∂–µ—Ç–∞?

### –ü—Ä–æ–±–ª–µ–º–∞ #2: API –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è (CORS/417)

**–û–ø–∏—Å–∞–Ω–∏–µ**:
- Edge Function –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 500
- –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –∫–ª–∏–µ–Ω—Ç–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è CORS
- API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 417 "–î–æ—Å—Ç—É–ø –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω" (IP –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)

**–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ**:
1. ‚úÖ –°–æ–∑–¥–∞–Ω Edge Function –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ –∑–∞—â–∏—Ç—ã –æ—Ç –±–æ—Ç–æ–≤
3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω fallback –Ω–∞ –≤–∏–¥–∂–µ—Ç –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ API
4. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω URL API –Ω–∞ `https://otpravka-api.pochta.ru`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
- Edge Function –∑–∞–¥–µ–ø–ª–æ–µ–Ω–∞
- URL API –æ–±–Ω–æ–≤–ª–µ–Ω
- –¢–æ–∫–µ–Ω –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- –í–∏–¥–∂–µ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ fallback

**–í–æ–ø—Ä–æ—Å—ã –¥–ª—è –¥—Ä—É–≥–∏—Ö –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π**:
1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω `ty2372MFNCTRiqBF8OfmoBBuMh785Ldy`?
2. –ù—É–∂–Ω–æ –ª–∏ –ø–æ–ª—É—á–∞—Ç—å OAuth —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–∞–º–∏?
3. –ö–∞–∫–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è API `otpravka-api.pochta.ru`?
4. –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ API –ü–æ—á—Ç—ã –†–æ—Å—Å–∏–∏?

### –ü—Ä–æ–±–ª–µ–º–∞ #3: –ö–Ω–æ–ø–∫–∞ "–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ" –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è

**–û–ø–∏—Å–∞–Ω–∏–µ**:
- –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –≤ –≤–∏–¥–∂–µ—Ç–µ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –∫–Ω–æ–ø–∫–æ–π "–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ"
- –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ `handleWidgetOfficeSelected` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è (callback –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

**–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ**:
1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä –æ—Ç–¥–µ–ª–µ–Ω–∏—è"
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤–∏–¥–∂–µ—Ç–∞
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω fallback –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (300‚ÇΩ) –µ—Å–ª–∏ API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä" –µ—Å—Ç—å, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞ –Ω–∞—Ö–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ
- –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤–∏–¥–∂–µ—Ç–∞

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–∂–µ—Ç–∞

–í–∏–¥–∂–µ—Ç –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ callback –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
```javascript
{
  id: string,           // ID –æ—Ç–¥–µ–ª–µ–Ω–∏—è
  name: string,         // –ù–∞–∑–≤–∞–Ω–∏–µ
  address: string,      // –ê–¥—Ä–µ—Å
  postalCode: string,  // –ü–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å
  index?: string       // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∏–Ω–¥–µ–∫—Å
}
```

### –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö API

**–ü–æ–∏—Å–∫ –æ—Ç–¥–µ–ª–µ–Ω–∏–π** (`/1.0/office`):
```
GET /1.0/office?filter=ALL&top=50&city=–ë–µ–ª–æ–≤–æ&postalCode=652612
```

**–†–∞—Å—á–µ—Ç –¥–æ—Å—Ç–∞–≤–∫–∏** (`/1.0/tariff`):
```
POST /1.0/tariff
Body: {
  object: 27020, // –¢–∏–ø –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è
  from: "101000", // –ò–Ω–¥–µ–∫—Å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
  to: "652612",   // –ò–Ω–¥–µ–∫—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è
  weight: 100,    // –í–µ—Å –≤ –≥—Ä–∞–º–º–∞—Ö
  declared-value: 1000 // –û–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
}
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

**–¢–∞–±–ª–∏—Ü–∞**: `delivery_services`
**–ö–æ–¥ —Å–ª—É–∂–±—ã**: `russian_post`

**–ü–æ–ª—è**:
- `api_key`: –¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ (`ty2372MFNCTRiqBF8OfmoBBuMh785Ldy`)
- `api_secret`: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –≤—Ç–æ—Ä–æ–π –∫–ª—é—á)
- `settings`: JSON —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
  ```json
  {
    "widget_id": 60084
  }
  ```

## üîç –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

1. **–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞** (F12):
   - –ï—Å—Ç—å –ª–∏ –ª–æ–≥–∏ `üîî Callback –≤—ã–∑–≤–∞–Ω!`?
   - –ï—Å—Ç—å –ª–∏ –ª–æ–≥–∏ `üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ`?
   - –ï—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è?

2. **–í –≤–∏–¥–∂–µ—Ç–µ**:
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ª–∏ –∫–∞—Ä—Ç–∞?
   - –ú–æ–∂–Ω–æ –ª–∏ –≤—ã–±—Ä–∞—Ç—å –æ—Ç–¥–µ–ª–µ–Ω–∏–µ?
   - –ü–æ—è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–∞–Ω–µ–ª—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—Ç–¥–µ–ª–µ–Ω–∏–∏?

3. **–í Edge Function**:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ Supabase Dashboard
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–æ–∫–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ URL API –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

## üí° –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

1. **–î–ª—è callback –≤–∏–¥–∂–µ—Ç–∞**:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤–∏–¥–∂–µ—Ç–∞: https://widget.pochta.ru/docs
   - –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–∏–¥–∂–µ—Ç –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å, –≤–∏–¥–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥—Ä—É–≥–æ–π –º–µ—Ö–∞–Ω–∏–∑–º (—Å–æ–±—ã—Ç–∏—è, –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)

2. **–î–ª—è API**:
   - –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω—É–∂–µ–Ω –ª–∏ OAuth —Ç–æ–∫–µ–Ω
   - –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–µ–Ω –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ IP (—á–µ—Ä–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫—É)

3. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤–∏–¥–∂–µ—Ç (–±–µ–∑ API)
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –æ—Ç–¥–µ–ª–µ–Ω–∏–µ –≤ –≤–∏–¥–∂–µ—Ç–µ
   - –î–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ –ø–∞–Ω–µ–ª–∏ –≤–∏–¥–∂–µ—Ç–∞ –≤—Ä—É—á–Ω—É—é
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏

## üìö –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

- –í–∏–¥–∂–µ—Ç: https://widget.pochta.ru/docs
- API: https://otpravka.pochta.ru/help/#/articles/content/383
- API: https://otpravka.pochta.ru/help/#/articles/content/560
- –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç: https://otpravka.pochta.ru

## üéØ –ì–ª–∞–≤–Ω—ã–π –≤–æ–ø—Ä–æ—Å –¥–ª—è –¥—Ä—É–≥–∏—Ö –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –∏–∑ –≤–∏–¥–∂–µ—Ç–∞ –ü–æ—á—Ç—ã –†–æ—Å—Å–∏–∏, –µ—Å–ª–∏ callback –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏?**

–í–∏–¥–∂–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Ç–∞–∫:
```javascript
ecomStartWidget({
  id: 60084,
  callbackFunction: function(data) {
    console.log('–î–∞–Ω–Ω—ã–µ:', data);
    // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è
  },
  containerId: 'ecom-widget'
});
```

–í–∏–¥–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—É, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –æ—Ç–¥–µ–ª–µ–Ω–∏–µ, –Ω–æ callback –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è. –ö–∞–∫ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–µ–Ω–∏—è?


