# Улучшения системы импорта товаров

## Что было добавлено

### 1. Отслеживание импорта товаров
- Добавлены поля в таблицу `products`:
  - `import_source` - источник импорта (wildberries, ozon, excel, csv, manual)
  - `imported_at` - дата и время импорта
  - `import_batch_id` - ID партии импорта (для группировки товаров из одного импорта)
  - `import_metadata` - дополнительные метаданные (JSON)

### 2. Улучшенный импорт Excel
- **Предпросмотр перед импортом** - вы можете увидеть все товары, которые будут импортированы, до начала процесса
- **Валидация данных** - система проверяет наличие обязательных полей (название, SKU) и показывает ошибки/предупреждения
- **Гибкие настройки**:
  - Выбор источника импорта
  - Обновление существующих товаров по SKU
  - Пропуск дубликатов

### 3. Массовое удаление товаров
- Удаление по фильтрам:
  - **По дате импорта** - удалить все товары, импортированные в определенный период
  - **По источнику импорта** - удалить все товары из WildBerries, OZON и т.д.
  - **По партии импорта** - удалить все товары из конкретной партии импорта
- **Предпросмотр** - перед удалением вы можете увидеть, сколько товаров будет удалено

## Как использовать

### Шаг 1: Выполните SQL миграцию

Выполните SQL скрипт `update_products_table_for_import.sql` в Supabase Dashboard → SQL Editor:

```sql
-- Скрипт находится в файле update_products_table_for_import.sql
```

### Шаг 2: Импорт товаров из Excel

1. Откройте страницу "Товары" в админ-панели
2. Нажмите кнопку **"Импорт Excel"**
3. Выберите Excel файл (.xlsx или .xls) с товарами WildBerries
4. Просмотрите предпросмотр импорта:
   - Проверьте количество товаров
   - Убедитесь, что нет критических ошибок
   - Ознакомьтесь с предупреждениями
5. Настройте параметры импорта:
   - Выберите источник импорта (WildBerries, OZON и т.д.)
   - Включите/выключите обновление существующих товаров
   - Включите/выключите пропуск дубликатов
6. Нажмите **"Импортировать"**

### Шаг 3: Массовое удаление товаров (если нужно)

1. Нажмите кнопку **"Массовое удаление"**
2. Выберите тип фильтра:
   - **По дате импорта** - укажите диапазон дат
   - **По источнику импорта** - выберите источник (WildBerries, OZON и т.д.)
   - **По партии импорта** - введите ID партии импорта
3. Нажмите **"Подсчитать товары"** для предпросмотра
4. Если все правильно, нажмите **"Удалить"**

## Формат Excel файла

Excel файл должен содержать следующие колонки (названия могут быть на русском или английском):

- **Название** / Name / Товар
- **Артикул** / SKU / Article
- **Штрихкод** / Barcode / EAN
- **Цена** / Price
- **Остаток** / Stock / Quantity / Количество
- **Категория** / Category
- **Подкатегория** / Subcategory
- **Материал** / Material
- **Цвета** / Colors (разделитель: `;` или `,`)
- **Размеры** / Sizes (разделитель: `;` или `,`)
- **Изображения** / Images (разделитель: `;` или `,`)

**Обязательные поля:** Название, Артикул (SKU)

## Безопасность

⚠️ **Внимание!** Массовое удаление товаров необратимо. Все связанные данные (заказы, отзывы, избранное) также будут затронуты.

Рекомендуется:
1. Сначала использовать предпросмотр для проверки количества товаров
2. Создать резервную копию базы данных перед массовым удалением
3. Удалять товары небольшими партиями для тестирования

## Примеры использования

### Пример 1: Импорт товаров из WildBerries
1. Экспортируйте товары из WildBerries в Excel
2. Откройте "Импорт Excel" в админ-панели
3. Выберите файл
4. Выберите источник: "WildBerries"
5. Включите "Обновлять существующие товары"
6. Импортируйте

### Пример 2: Удаление тестового импорта
1. Откройте "Массовое удаление"
2. Выберите фильтр: "По дате импорта"
3. Укажите дату начала и конца тестового импорта
4. Нажмите "Подсчитать товары"
5. Проверьте количество
6. Удалите

### Пример 3: Удаление всех товаров из конкретного источника
1. Откройте "Массовое удаление"
2. Выберите фильтр: "По источнику импорта"
3. Выберите источник (например, "WildBerries")
4. Нажмите "Подсчитать товары"
5. Проверьте количество
6. Удалите

## Технические детали

- Все импортированные товары получают уникальный `import_batch_id` для группировки
- Метаданные импорта сохраняются в поле `import_metadata` (JSON)
- Индексы созданы для быстрого поиска по `import_source`, `imported_at`, `import_batch_id`
- Система автоматически определяет категорию товара на основе названия колонки

## Поддержка

Если возникли проблемы:
1. Проверьте формат Excel файла
2. Убедитесь, что обязательные поля (название, SKU) заполнены
3. Проверьте консоль браузера на наличие ошибок
4. Убедитесь, что SQL миграция выполнена успешно




