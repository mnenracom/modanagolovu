# Система управления заказами

## Реализованные функции

### 1. Список всех заказов
- ✅ Таблица с информацией о заказах
- ✅ Номер заказа, клиент, товары, сумма, статус, оплата, дата
- ✅ Отображение изображений товаров
- ✅ Ссылки на детальную страницу заказа

### 2. Фильтры по статусу/дате
- ✅ Фильтр по статусу заказа (все статусы, ожидает, обрабатывается, и т.д.)
- ✅ Фильтр по периоду (сегодня, неделя, месяц, все периоды)
- ✅ Поиск по номеру заказа, имени клиента, email, телефону
- ✅ Комбинированные фильтры

### 3. Детали заказа
- ✅ Полная информация о заказе
- ✅ Список товаров с изображениями, цветами, размерами
- ✅ Информация о клиенте (контакты, адрес)
- ✅ Информация об оплате и доставке
- ✅ Итоговая сумма с разбивкой (товары, скидка, доставка)

### 4. Изменение статусов
- ✅ Диалоговое окно для изменения статуса
- ✅ Выбор нового статуса из списка
- ✅ Добавление комментария к изменению
- ✅ Автоматическое сохранение в историю

### 5. История изменений
- ✅ Полная история всех изменений статуса заказа
- ✅ Отображение предыдущего и нового статуса
- ✅ Комментарии к изменениям
- ✅ Кто и когда внес изменения
- ✅ Сортировка по дате (новые сверху)

## Статусы заказов

- `pending` - Ожидает обработки
- `processing` - В обработке
- `confirmed` - Подтвержден
- `preparing` - Готовится
- `shipped` - Отправлен
- `delivered` - Доставлен
- `cancelled` - Отменен
- `refunded` - Возвращен

## Структура данных

### Order (Заказ)
```typescript
{
  id: string;
  orderNumber: string;
  userId?: string;
  customer: {
    name: string;
    email: string;
    phone: string;
    address: string;
    telegram?: string;
    whatsapp?: string;
  };
  items: OrderItem[];
  subtotal: number;
  shippingCost: number;
  discount: number;
  total: number;
  status: OrderStatus;
  paymentMethod: 'online' | 'invoice' | 'cash';
  paymentStatus: 'pending' | 'paid' | 'failed' | 'refunded';
  shippingMethod: 'pickup' | 'delivery' | 'courier';
  trackingNumber?: string;
  notes?: string;
  history: OrderHistoryEntry[];
  createdAt: string;
  updatedAt: string;
}
```

### OrderHistoryEntry (Запись истории)
```typescript
{
  id: string;
  status: OrderStatus;
  comment?: string;
  changedBy: string;
  changedByName?: string;
  timestamp: string;
  previousStatus?: OrderStatus;
}
```

## API Endpoints

### Заказы
- `GET /admin/orders` - Список заказов (с фильтрами)
- `GET /admin/orders/:id` - Получить заказ
- `PATCH /admin/orders/:id/status` - Изменить статус заказа
- `PUT /admin/orders/:id` - Обновить заказ
- `DELETE /admin/orders/:id` - Удалить заказ

### Параметры запроса для списка заказов:
- `page` - номер страницы
- `limit` - количество на странице
- `status` - фильтр по статусу
- `date` - фильтр по периоду (today, week, month)
- `search` - поисковый запрос

## Использование

### Просмотр заказов
1. Перейдите в раздел "Заказы" в админ-панели
2. Используйте фильтры для поиска нужных заказов
3. Нажмите на иконку глаза для просмотра деталей

### Изменение статуса заказа
1. Откройте детальную страницу заказа
2. Нажмите "Изменить статус"
3. Выберите новый статус
4. Добавьте комментарий (опционально)
5. Сохраните изменения

### История изменений
- История автоматически сохраняется при каждом изменении статуса
- Отображается на странице деталей заказа
- Показывает все изменения с временными метками

## Особенности

### Автоматическая генерация номера заказа
Формат: `ORD-YYYYMMDD-XXXXXX`
- Год, месяц, день
- 6-значный порядковый номер

### Снимок товара
При создании заказа сохраняется снимок товара (productSnapshot) для сохранения информации на момент заказа.

### Автоматическая история
Каждое изменение статуса автоматически добавляется в историю с информацией:
- Новый статус
- Предыдущий статус
- Кто внес изменение
- Комментарий
- Временная метка

## Следующие шаги

1. Добавить уведомления клиентам при изменении статуса
2. Реализовать печать накладных
3. Добавить экспорт заказов в Excel/PDF
4. Реализовать массовые операции над заказами
5. Добавить статистику по заказам
6. Интеграция с системами доставки для трек-номеров









